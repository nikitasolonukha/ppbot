<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>–†–µ—Ü–µ–ø—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        body {
            background: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            touch-action: none;
        }

        #watermark-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
            opacity: 0.08;
            overflow: hidden;
        }
        
        /* –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ container –≤—ã—à–µ watermark */
        #container {
            z-index: 9999 !important;
        }

        .watermark-text {
            position: absolute;
            color: #fff;
            font-size: 14px;
            transform: rotate(25deg);
            white-space: nowrap;
            font-weight: 300;
        }

        #container {
            position: relative;
            z-index: 1;
            padding: 20px;
            max-width: 100%;
            min-height: 100vh;
            display: block;
            visibility: visible;
            background: #000;
        }

        #canvas-container {
            position: relative;
            width: 100%;
            margin: 0 auto;
            background: #000;
        }

        #recipe-canvas {
            display: block !important;
            width: 100%;
            height: auto;
            max-width: 100%;
            background: #000 !important;
            visibility: visible !important;
            opacity: 1 !important;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            margin: 0 auto;
        }

        #error-message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 24px;
            z-index: 10000;
            color: #ff4444;
        }

        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 18px;
            z-index: 10001;
        }

        @media print {
            body * {
                display: none !important;
            }
            body::before {
                content: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω";
                display: block !important;
                font-size: 24px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div id="watermark-overlay"></div>
    <div id="container">
        <canvas id="recipe-canvas"></canvas>
    </div>
    <div id="error-message">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</div>
    <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="debug-info" style="position:fixed;top:10px;left:10px;background:rgba(255,0,0,0.8);color:#fff;padding:10px;font-size:12px;z-index:10002;max-width:300px;display:none;"></div>

    <script>
        // ‚ö†Ô∏è –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –≤ WebApp. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±—Ä–∞—É–∑–µ—Ä–∞.

        const tg = window.Telegram?.WebApp;
        if (!tg) {
            document.body.innerHTML = '<div id="error-message" style="display:block;">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</div>';
            throw new Error('Not in Telegram WebApp');
        }

        tg.ready();
        tg.expand();

        const user = tg.initDataUnsafe?.user;
        const userId = user?.id || 'unknown';
        const username = user?.username || `user_${userId}`;
        const currentTime = new Date().toLocaleString('ru-RU');

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–∞ –∏–∑ initData –∏–ª–∏ URL
        const urlParams = new URLSearchParams(window.location.search);
        const recipeId = urlParams.get('id');
        
        let recipeData = {
            name: '–†–µ—Ü–µ–ø—Ç',
            calories: 0,
            proteins: 0,
            fats: 0,
            carbs: 0,
            ingredients: ['–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã'],
            instructions: ['–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã']
        };
        
        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
        const debugInfo = document.getElementById('debug-info');
        debugInfo.style.display = 'block';
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–∞ –ø–æ ID –∏–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ JSON —Ñ–∞–π–ª–∞
        async function loadRecipeData() {
            if (!recipeId) {
                debugInfo.innerHTML = '‚ùå ID —Ä–µ—Ü–µ–ø—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω –≤ URL';
                document.getElementById('loading').textContent = 'ID —Ä–µ—Ü–µ–ø—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω';
                return;
            }
            
            debugInfo.innerHTML = `ID —Ä–µ—Ü–µ–ø—Ç–∞: ${recipeId}<br>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...`;
            
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π JSON —Ñ–∞–π–ª —Å —Ä–µ—Ü–µ–ø—Ç–∞–º–∏
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–≥–æ HTML —Ñ–∞–π–ª–∞
                const currentPath = window.location.pathname;
                const basePath = currentPath.substring(0, currentPath.lastIndexOf('/'));
                const jsonUrl = basePath + '/webapp_recipes.json';
                
                debugInfo.innerHTML += `<br>–ó–∞–≥—Ä—É–∑–∫–∞: ${jsonUrl}`;
                const response = await fetch(jsonUrl);
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(`–§–∞–π–ª webapp_recipes.json –Ω–µ –Ω–∞–π–¥–µ–Ω (404). –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ GitHub Pages –≤ —Ç—É –∂–µ –ø–∞–ø–∫—É, —á—Ç–æ –∏ webapp_recipe.html`);
                    }
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const allRecipes = await response.json();
                debugInfo.innerHTML += '<br>‚úÖ JSON —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω';
                
                // –ò—â–µ–º —Ä–µ—Ü–µ–ø—Ç –ø–æ ID
                const recipe = allRecipes[recipeId];
                if (!recipe) {
                    throw new Error(`–†–µ—Ü–µ–ø—Ç —Å ID "${recipeId}" –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                }
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤ –ø–æ–ª–Ω—ã–π
                recipeData = {
                    name: recipe.n || recipe.name || '–†–µ—Ü–µ–ø—Ç',
                    calories: recipe.c !== undefined ? recipe.c : (recipe.calories || 0),
                    proteins: recipe.p !== undefined ? recipe.p : (recipe.proteins || 0),
                    fats: recipe.f !== undefined ? recipe.f : (recipe.fats || 0),
                    carbs: recipe.cb !== undefined ? recipe.cb : (recipe.carbs || 0),
                    ingredients: recipe.i || recipe.ingredients || [],
                    instructions: recipe.ins || recipe.instructions || []
                };
                
                debugInfo.innerHTML += `<br>‚úÖ –†–µ—Ü–µ–ø—Ç –Ω–∞–π–¥–µ–Ω: ${recipeData.name}<br>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤: ${recipeData.ingredients.length}`;
                console.log('–î–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', recipeData.name);
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ—Ü–µ–ø—Ç
                document.getElementById('loading').style.display = 'none';
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ canvas –≤–∏–¥–∏–º—ã
                const container = document.getElementById('container');
                const canvas = document.getElementById('recipe-canvas');
                
                if (container) {
                    container.style.display = 'block';
                    container.style.visibility = 'visible';
                    container.style.opacity = '1';
                }
                
                if (canvas) {
                    canvas.style.display = 'block';
                    canvas.style.visibility = 'visible';
                    canvas.style.opacity = '1';
                }
                
                // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ—Ü–µ–ø—Ç
                try {
                    renderRecipe();
                    generateWatermark();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ canvas –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω
                    const canvasAfter = document.getElementById('recipe-canvas');
                    if (canvasAfter && canvasAfter.height > 0) {
                        debugInfo.innerHTML += `<br>‚úÖ –†–µ—Ü–µ–ø—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω (canvas: ${canvasAfter.width}x${canvasAfter.height})`;
                    } else {
                        debugInfo.innerHTML += '<br>‚ö†Ô∏è Canvas –Ω–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω (–≤—ã—Å–æ—Ç–∞ = 0)';
                    }
                } catch (e) {
                    debugInfo.innerHTML += `<br>‚ùå –û—à–∏–±–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏: ${e.message}`;
                    debugInfo.innerHTML += `<br>Stack: ${e.stack}`;
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏:', e);
                }
                
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–∞:', e);
                debugInfo.innerHTML += `<br>‚ùå –û—à–∏–±–∫–∞: ${e.message}`;
                document.getElementById('loading').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–∞: ' + e.message;
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–∞
        loadRecipeData();

        // Watermark –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
        function generateWatermark() {
            const overlay = document.getElementById('watermark-overlay');
            overlay.innerHTML = '';
            const watermarkText = `${username} | ${userId} | ${currentTime}`;
            const spacing = 200;
            const rows = Math.ceil(window.innerHeight / spacing) + 2;
            const cols = Math.ceil(window.innerWidth / spacing) + 2;

            for (let i = -1; i < rows; i++) {
                for (let j = -1; j < cols; j++) {
                    const span = document.createElement('span');
                    span.className = 'watermark-text';
                    span.textContent = watermarkText;
                    span.style.left = (j * spacing) + 'px';
                    span.style.top = (i * spacing) + 'px';
                    overlay.appendChild(span);
                }
            }
        }

        // Canvas —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ä–µ—Ü–µ–ø—Ç–∞
        function renderRecipe() {
            console.log('renderRecipe –≤—ã–∑–≤–∞–Ω–∞, recipeData:', recipeData);
            const canvas = document.getElementById('recipe-canvas');
            if (!canvas) {
                throw new Error('Canvas –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞–µ–º canvas –≤–∏–¥–∏–º—ã–º
            canvas.style.display = 'block';
            canvas.style.visibility = 'visible';
            canvas.style.opacity = '1';
            canvas.style.position = 'relative';
            canvas.style.zIndex = '10';
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç canvas');
            }
            
            const container = document.getElementById('container');
            if (container) {
                container.style.display = 'block';
                container.style.visibility = 'visible';
            }
            
            const maxWidth = Math.min(window.innerWidth - 40, 600);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
            canvas.width = maxWidth;
            // –í—Ä–µ–º–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É, –ø–æ—Ç–æ–º —É–≤–µ–ª–∏—á–∏–º
            canvas.height = 2000; // –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞
            
            // –û—á–∏—â–∞–µ–º canvas —á–µ—Ä–Ω—ã–º —Ñ–æ–Ω–æ–º
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            debugInfo.innerHTML += `<br>Canvas –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: ${canvas.width}x${canvas.height}`;

            ctx.fillStyle = '#fff';
            ctx.font = 'bold 24px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';
            ctx.textBaseline = 'top';
            ctx.textAlign = 'left';

            let y = 30;
            const padding = 20;
            const lineHeight = 28;
            const sectionSpacing = 20;

            // –ù–∞–∑–≤–∞–Ω–∏–µ
            ctx.font = 'bold 28px -apple-system';
            const nameLines = wrapText(ctx, recipeData.name, maxWidth - padding * 2);
            nameLines.forEach(line => {
                ctx.fillText(line, padding, y);
                y += lineHeight + 4;
            });

            y += sectionSpacing;

            // –ö–ë–ñ–£
            ctx.font = 'bold 20px -apple-system';
            ctx.fillText('üìä –ö–ë–ñ–£', padding, y);
            y += lineHeight + 10;

            ctx.font = '18px -apple-system';
            ctx.fillText(`üî• –ö–∞–ª–æ—Ä–∏–∏: ${recipeData.calories} –∫–∫–∞–ª`, padding, y);
            y += lineHeight;
            ctx.fillText(`ü•ö –ë–µ–ª–∫–∏: ${recipeData.proteins} –≥`, padding, y);
            y += lineHeight;
            ctx.fillText(`üßà –ñ–∏—Ä—ã: ${recipeData.fats} –≥`, padding, y);
            y += lineHeight;
            ctx.fillText(`üçû –£–≥–ª–µ–≤–æ–¥—ã: ${recipeData.carbs} –≥`, padding, y);

            y += sectionSpacing * 2;

            // –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
            ctx.font = 'bold 20px -apple-system';
            ctx.fillText('üõí –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã', padding, y);
            y += lineHeight + 10;

            ctx.font = '18px -apple-system';
            const ingredients = Array.isArray(recipeData.ingredients) 
                ? recipeData.ingredients.filter(ing => ing && ing.trim()) 
                : [recipeData.ingredients].filter(ing => ing && ing.trim());
            if (ingredients.length === 0) {
                ingredients.push('–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã');
            }
            ingredients.forEach(ing => {
                const ingText = typeof ing === 'string' ? ing : String(ing);
                const lines = wrapText(ctx, `‚Ä¢ ${ingText}`, maxWidth - padding * 2);
                lines.forEach(line => {
                    ctx.fillText(line, padding + 10, y);
                    y += lineHeight;
                });
            });

            y += sectionSpacing * 2;

            // –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ
            ctx.font = 'bold 20px -apple-system';
            ctx.fillText('üë©üèΩ‚Äçüç≥ –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ', padding, y);
            y += lineHeight + 10;

            ctx.font = '18px -apple-system';
            const instructions = Array.isArray(recipeData.instructions) 
                ? recipeData.instructions.filter(inst => inst && inst.trim()) 
                : [recipeData.instructions].filter(inst => inst && inst.trim());
            if (instructions.length === 0) {
                instructions.push('–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã');
            }
            instructions.forEach((inst, idx) => {
                const instText = typeof inst === 'string' ? inst : String(inst);
                const text = `${idx + 1}. ${instText}`;
                const lines = wrapText(ctx, text, maxWidth - padding * 2);
                lines.forEach(line => {
                    ctx.fillText(line, padding, y);
                    y += lineHeight;
                });
                y += 8;
            });

            // Watermark –Ω–∞ canvas
            ctx.save();
            ctx.globalAlpha = 0.05;
            ctx.fillStyle = '#fff';
            ctx.font = '12px -apple-system';
            ctx.rotate(25 * Math.PI / 180);
            const watermarkCanvas = `${username} | ${userId} | ${currentTime}`;
            const watermarkSpacing = 150;
            for (let i = -2; i < 10; i++) {
                for (let j = -2; j < 10; j++) {
                    ctx.fillText(watermarkCanvas, j * watermarkSpacing, i * watermarkSpacing);
                }
            }
            ctx.restore();

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É canvas
            const finalHeight = y + padding;
            if (finalHeight > 0) {
                canvas.height = finalHeight;
                debugInfo.innerHTML += `<br>Canvas —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: ${canvas.width}x${canvas.height}`;
            } else {
                debugInfo.innerHTML += '<br>‚ö†Ô∏è –§–∏–Ω–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ = 0, y=' + y;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ canvas –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω
            const imageData = ctx.getImageData(0, 0, Math.min(10, canvas.width), Math.min(10, canvas.height));
            const hasContent = imageData.data.some((val, idx) => idx % 4 !== 3 && val !== 0); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ-–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –ø–∏–∫—Å–µ–ª–∏
            debugInfo.innerHTML += `<br>Canvas –∏–º–µ–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç: ${hasContent ? '–¥–∞' : '–Ω–µ—Ç'}`;
        }

        function wrapText(ctx, text, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = '';

            words.forEach(word => {
                const testLine = currentLine + (currentLine ? ' ' : '') + word;
                const metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && currentLine) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine = testLine;
                }
            });
            if (currentLine) lines.push(currentLine);
            return lines;
        }

        // –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('copy', (e) => {
            e.preventDefault();
            e.clipboardData.setData('text/plain', '');
            return false;
        });

        document.addEventListener('cut', (e) => {
            e.preventDefault();
            return false;
        });

        document.addEventListener('paste', (e) => {
            e.preventDefault();
            return false;
        });

        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            return false;
        });

        document.addEventListener('selectstart', (e) => {
            e.preventDefault();
            return false;
        });

        document.addEventListener('dragstart', (e) => {
            e.preventDefault();
            return false;
        });

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à
        document.addEventListener('keydown', (e) => {
            // Ctrl+C, Ctrl+U, Ctrl+S, Ctrl+P, Ctrl+A
            if (e.ctrlKey && ['c', 'u', 's', 'p', 'a'].includes(e.key.toLowerCase())) {
                e.preventDefault();
                return false;
            }
            // F12, PrintScreen
            if (e.key === 'F12' || e.keyCode === 44) {
                e.preventDefault();
                return false;
            }
            // DevTools shortcuts
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && ['i', 'j', 'c'].includes(e.key.toLowerCase()))) {
                e.preventDefault();
                return false;
            }
        });

        // Anti DevTools
        let devToolsOpen = false;
        function checkDevTools() {
            const threshold = 160;
            const widthDiff = window.outerWidth - window.innerWidth;
            const heightDiff = window.outerHeight - window.innerHeight;

            if (widthDiff > threshold || heightDiff > threshold) {
                if (!devToolsOpen) {
                    devToolsOpen = true;
                    document.body.innerHTML = '<div id="error-message" style="display:block;">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</div>';
                }
            } else {
                devToolsOpen = false;
            }
        }

        setInterval(checkDevTools, 500);

        // –ó–∞—â–∏—Ç–∞ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                document.body.style.filter = 'blur(30px)';
            } else {
                document.body.style.filter = 'none';
            }
        });

        // –ó–∞—â–∏—Ç–∞ –æ—Ç print
        window.addEventListener('beforeprint', () => {
            document.body.innerHTML = '<div style="font-size:24px;text-align:center;padding:50px;">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</div>';
        });

        window.addEventListener('afterprint', () => {
            location.reload();
        });

        // –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', (e) => {
            e.preventDefault();
            e.returnValue = '';
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ - –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ—Ü–µ–ø—Ç
        window.addEventListener('resize', () => {
            if (recipeData && recipeData.name !== '–†–µ—Ü–µ–ø—Ç') {
                generateWatermark();
                renderRecipe();
            }
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        Object.defineProperty(window, 'devtools', {
            get: function() {
                return {
                    open: function() {
                        document.body.innerHTML = '<div id="error-message" style="display:block;">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω</div>';
                    }
                };
            }
        });

        // –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Å–æ–ª–∏
        const noop = () => {};
        const methods = ['log', 'debug', 'info', 'warn', 'error', 'assert', 'clear', 'count', 'dir', 'dirxml', 'group', 'groupCollapsed', 'groupEnd', 'profile', 'profileEnd', 'table', 'time', 'timeEnd', 'timeStamp', 'trace'];
        methods.forEach(method => {
            console[method] = noop;
        });
    </script>
</body>
</html>
